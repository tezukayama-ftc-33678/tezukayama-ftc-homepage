<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç·¨é›† â€” Tezukayama-Rise (ãƒ­ãƒ¼ã‚«ãƒ«å°‚ç”¨)</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:20px;background:#f6f8fb}
    h1{font-size:1.4rem}
    .box{background:#fff;padding:16px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.06);margin-bottom:12px}
    label{display:block;margin-top:8px;font-weight:600}
    input[type=text], textarea, select{width:100%;padding:8px;margin-top:6px;border:1px solid #ddd;border-radius:6px}
    .row{display:flex;gap:8px}
    .row > *{flex:1}
    button{padding:8px 12px;border-radius:6px;border:none;background:#4f46e5;color:#fff;cursor:pointer}
    button.ghost{background:#fff;color:#111;border:1px solid #ddd}
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;margin-top:10px}
    .card-edit{background:#fafafa;padding:10px;border-radius:8px;border:1px dashed #e5e7eb}
    .small{font-size:0.9rem;padding:6px 8px}
    .actions{display:flex;gap:8px;margin-top:10px}
    .danger{background:#ef4444}
    .ok{background:#10b981}
    .muted{color:#6b7280;font-size:0.9rem}
  </style>
</head>
<body>
  <h1>Tezukayama-Rise ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç·¨é›†ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«å°‚ç”¨ï¼‰</h1>
  <p class="muted">ã“ã®ãƒšãƒ¼ã‚¸ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§ `content.json` ã‚’ç·¨é›†ã—ã‚„ã™ãã™ã‚‹ãŸã‚ã®ç°¡æ˜“UIã§ã™ã€‚å…¬é–‹ãƒªãƒã‚¸ãƒˆãƒªã§ã®å®Ÿè¡Œã¯æ¨å¥¨ã—ã¾ã›ã‚“ã€‚</p>

  <div class="box" id="main-controls">
    <div class="row">
      <button id="loadBtn">content.json ã‚’èª­ã¿è¾¼ã‚€</button>
      <input id="uploadFile" type="file" accept="application/json" style="margin-left:8px">
      <button id="resetBtn" class="ghost">ç·¨é›†ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
      <button id="downloadBtn" class="ok">JSON ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
    </div>
    <div class="actions">
      <button id="previewBtn" class="ghost">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ (index ã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã)</button>
      <button id="validateBtn" class="ghost">ç°¡æ˜“æ¤œè¨¼</button>
    </div>
  </div>

  <div id="editor" style="display:none">
    <div class="box">
      <h2>ãƒ˜ãƒƒãƒ€ãƒ¼ / ãƒ’ãƒ¼ãƒ­ãƒ¼</h2>
      <label>ãƒãƒ¼ãƒ ç•ªå·</label>
      <input type="text" id="teamNumber">
      <label>ãƒãƒ¼ãƒ å</label>
      <input type="text" id="teamName">
      <label>ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«</label>
      <input type="text" id="heroTitle">
      <label>ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«</label>
      <input type="text" id="heroSubtitle">
      <label>ãƒ’ãƒ¼ãƒ­ãƒ¼èª¬æ˜ (HTML ã®ç°¡æ˜“ã‚¿ã‚°å¯)</label>
      <textarea id="heroDescription" rows="3"></textarea>
    </div>

    <div class="box">
      <h2>About ã‚»ã‚¯ã‚·ãƒ§ãƒ³</h2>
      <label>ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ«</label>
      <input type="text" id="aboutTitle">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
        <strong>ã‚«ãƒ¼ãƒ‰ä¸€è¦§</strong>
        <div>
          <button id="addAboutCard" class="small">+ ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ </button>
        </div>
      </div>
      <div id="aboutCards" class="cards"></div>
    </div>

    <div class="box">
      <h2>è¿½åŠ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆä»»æ„ï¼‰</h2>
      <p class="muted">è‡ªç”±ã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œã‚Šã€ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ ã§ãã¾ã™ã€‚ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ `sections` é…åˆ—ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
        <strong>ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§</strong>
        <div>
          <button id="addSection" class="small">+ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ </button>
        </div>
      </div>
      <div id="sectionsContainer"></div>
    </div>

    <div class="box">
      <h2>Outreach ã‚»ã‚¯ã‚·ãƒ§ãƒ³</h2>
      <label>ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ«</label>
      <input type="text" id="outreachTitle" value="ã‚¢ã‚¦ãƒˆãƒªãƒ¼ãƒæ´»å‹•">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
        <strong>ã‚«ãƒ¼ãƒ‰ä¸€è¦§</strong>
        <div>
          <button id="addOutreachCard" class="small">+ ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ </button>
        </div>
      </div>
      <div id="outreachCards" class="cards"></div>
    </div>

    <div class="box">
      <h2>Contact / Footerï¼ˆç°¡æ˜“ï¼‰</h2>
      <label>ãƒ¡ãƒ¼ãƒ«ã‚¿ã‚¤ãƒˆãƒ«</label>
      <input id="contactEmailTitle" type="text">
      <label>ãƒ¡ãƒ¼ãƒ«ãƒ†ã‚­ã‚¹ãƒˆ</label>
      <input id="contactEmailText" type="text">
      <label>Footer ã‚³ãƒ”ãƒ¼</label>
      <input id="footerCopy" type="text">
    </div>
  </div>

  <script>
    let content = null;
    const safeCheck = str => /<script\b|onerror=|onload=|javascript:/i.test(str);

    document.getElementById('loadBtn').addEventListener('click', async ()=>{
      try{
        const r = await fetch('content.json');
        const j = await r.json();
        content = j;
        populateForm(j);
        document.getElementById('editor').style.display = 'block';
        alert('èª­ã¿è¾¼ã¿å®Œäº†');
      }catch(e){
        alert('content.json ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
        console.error(e);
      }
    });

    // Upload JSON file and load into editor
    document.getElementById('uploadFile').addEventListener('change', async (e)=>{
      const f = e.target.files && e.target.files[0];
      if (!f) return;
      try{
        const text = await f.text();
        const j = JSON.parse(text);
        content = j;
        populateForm(j);
        document.getElementById('editor').style.display = 'block';
        alert('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¨èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸ');
      }catch(err){
        alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã¾ãŸã¯ãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ã¾ã—ãŸ');
        console.error(err);
      }
    });

    document.getElementById('previewBtn').addEventListener('click', ()=>{
      window.open('index.html','_blank');
    });

    document.getElementById('resetBtn').addEventListener('click', ()=>{
      if (!content) return alert('ã¾ã èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
      populateForm(content);
    });

    document.getElementById('validateBtn').addEventListener('click', ()=>{
      const j = gatherForm();
      const issues = validateJSON(j);
      if (issues.length===0) alert('å•é¡Œã‚ã‚Šã¾ã›ã‚“');
      else alert('æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ:\n- '+issues.join('\n- '));
    });

    document.getElementById('downloadBtn').addEventListener('click', ()=>{
      const j = gatherForm();
      const issues = validateJSON(j);
      if (issues.length>0){
        if (!confirm('æ¤œå‡ºã•ã‚ŒãŸå•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚ã‚ˆã„ã§ã™ã‹?\n- '+issues.join('\n- '))) return;
      }
      const blob = new Blob([JSON.stringify(j,null,2)],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'content.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    function createCardEditor(container, card, onRemove){
      const el = document.createElement('div'); el.className='card-edit';
      const icon = document.createElement('input'); icon.type='text'; icon.value = card.icon || '';
      const title = document.createElement('input'); title.type='text'; title.value=card.title||'';
      const text = document.createElement('textarea'); text.rows=4; text.value=card.text||'';
      const imageUrl = document.createElement('input'); imageUrl.type='text'; imageUrl.placeholder='ç”»åƒã®URLï¼ˆä»»æ„ï¼‰'; imageUrl.value = card.imageUrl || '';
      const uploadImg = document.createElement('input'); uploadImg.type='file'; uploadImg.accept='image/*'; uploadImg.style.marginTop='6px';
      uploadImg.addEventListener('change', async (e)=>{
        const f = e.target.files && e.target.files[0]; if(!f) return;
        const reader = new FileReader();
        reader.onload = ()=>{ imageUrl.value = reader.result; };
        reader.readAsDataURL(f);
      });
      const removeBtn = document.createElement('button'); removeBtn.textContent='å‰Šé™¤'; removeBtn.className='small danger';
      removeBtn.addEventListener('click', ()=>{ el.remove(); if(onRemove) onRemove(); });
      el.appendChild(document.createTextNode('ã‚¢ã‚¤ã‚³ãƒ³')); el.appendChild(icon);
      el.appendChild(document.createTextNode('ã‚¿ã‚¤ãƒˆãƒ«')); el.appendChild(title);
      el.appendChild(document.createTextNode('æœ¬æ–‡ (HTMLå¯)')); el.appendChild(text);
      el.appendChild(document.createTextNode('ç”»åƒURL (ä»»æ„)')); el.appendChild(imageUrl);
      el.appendChild(document.createTextNode('ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰')); el.appendChild(uploadImg);
      el.appendChild(removeBtn);
      // attach getters
      el.getCard = ()=>({icon:icon.value.trim(),title:title.value.trim(),text:text.value.trim(), imageUrl: imageUrl.value.trim() || undefined});
      container.appendChild(el);
      return el;
    }

    function populateForm(j){
      document.getElementById('teamNumber').value = j.teamNumber || '';
      document.getElementById('teamName').value = j.teamName || '';
      document.getElementById('heroTitle').value = j.heroTitle || '';
      document.getElementById('heroSubtitle').value = j.heroSubtitle || '';
      document.getElementById('heroDescription').value = j.heroDescription || '';

      document.getElementById('aboutTitle').value = j.aboutTitle || '';
      const aboutContainer = document.getElementById('aboutCards'); aboutContainer.innerHTML='';
      const aboutCards = (j.about && Array.isArray(j.about.cards)) ? j.about.cards : [
        {icon:'ğŸ¤–',title:(j.aboutMission && j.aboutMission.title)||'',text:(j.aboutMission && j.aboutMission.text)||''},
        {icon:'ğŸŒŸ',title:(j.aboutValues && j.aboutValues.title)||'',text:(j.aboutValues && j.aboutValues.text)||''},
        {icon:'ğŸ¯',title:(j.aboutGoals && j.aboutGoals.title)||'',text:(j.aboutGoals && j.aboutGoals.text)||''}
      ];
      aboutCards.forEach(c=>createCardEditor(aboutContainer,c));

      document.getElementById('outreachTitle').value = (j.outreach && j.outreach.title) || 'ã‚¢ã‚¦ãƒˆãƒªãƒ¼ãƒæ´»å‹•';
      const outContainer = document.getElementById('outreachCards'); outContainer.innerHTML='';
      const outreachCards = (j.outreach && Array.isArray(j.outreach.cards))? j.outreach.cards : [];
      outreachCards.forEach(c=>createCardEditor(outContainer,c));

      document.getElementById('contactEmailTitle').value = (j.contact && j.contact.email && j.contact.email.title) || '';
      document.getElementById('contactEmailText').value = (j.contact && j.contact.email && j.contact.email.text) || '';
      document.getElementById('footerCopy').value = (j.footer && j.footer.copy) || '';
    }

    document.getElementById('addAboutCard').addEventListener('click', ()=>{
      createCardEditor(document.getElementById('aboutCards'),{icon:'ğŸ“Œ',title:'æ–°ã—ã„ã‚«ãƒ¼ãƒ‰',text:''});
    });
    document.getElementById('addOutreachCard').addEventListener('click', ()=>{
      createCardEditor(document.getElementById('outreachCards'),{icon:'ğŸ“š',title:'æ–°ã—ã„ã‚«ãƒ¼ãƒ‰',text:''});
    });

    // Sections (arbitrary) support
    function createSectionEditor(section){
      const container = document.getElementById('sectionsContainer');
      const wrapper = document.createElement('div'); wrapper.className='card-edit';
      const keyInput = document.createElement('input'); keyInput.type='text'; keyInput.placeholder='section_key (ä¾‹: events)'; keyInput.value = section.key||'';
      const titleInput = document.createElement('input'); titleInput.type='text'; titleInput.placeholder='è¡¨ç¤ºã‚¿ã‚¤ãƒˆãƒ«'; titleInput.value = section.title||'';
      const navPosLabel = document.createElement('div'); navPosLabel.textContent='ãƒŠãƒ“æŒ¿å…¥ä½ç½® (ä»»æ„)'; navPosLabel.style.marginTop='6px';
      const navPosSelect = document.createElement('select'); navPosSelect.className='small';
      ['none','start','end','index'].forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; if(section.navPosition===v) o.selected=true; navPosSelect.appendChild(o)});
      const navIndexInput = document.createElement('input'); navIndexInput.type='number'; navIndexInput.placeholder='index (0-based)'; navIndexInput.value = section.navIndex!=null? section.navIndex : '';
      navIndexInput.style.display = (navPosSelect.value==='index') ? 'inline-block' : 'none';
      navPosSelect.addEventListener('change', ()=>{ navIndexInput.style.display = (navPosSelect.value==='index') ? 'inline-block' : 'none'; });
      const cardsContainer = document.createElement('div'); cardsContainer.style.marginTop='8px';
      const addCardBtn = document.createElement('button'); addCardBtn.className='small'; addCardBtn.textContent='+ ã‚«ãƒ¼ãƒ‰è¿½åŠ ';
      addCardBtn.addEventListener('click', ()=> createCardEditor(cardsContainer,{icon:'ğŸ“Œ',title:'æ–°ã—ã„ã‚«ãƒ¼ãƒ‰',text:''}));
      const removeBtn = document.createElement('button'); removeBtn.className='small danger'; removeBtn.textContent='ã‚»ã‚¯ã‚·ãƒ§ãƒ³å‰Šé™¤'; removeBtn.addEventListener('click', ()=> wrapper.remove());

      wrapper.appendChild(document.createTextNode('ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚­ãƒ¼')); wrapper.appendChild(keyInput);
      wrapper.appendChild(document.createTextNode('ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ«')); wrapper.appendChild(titleInput);
      const secImageLabel = document.createElement('div'); secImageLabel.textContent='ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç”»åƒ (ä»»æ„)';
      const secImageInput = document.createElement('input'); secImageInput.type='text'; secImageInput.placeholder='ç”»åƒURL'; secImageInput.value = section.imageUrl || '';
      const secImageUpload = document.createElement('input'); secImageUpload.type='file'; secImageUpload.accept='image/*';
      secImageUpload.addEventListener('change', (e)=>{ const f = e.target.files && e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ secImageInput.value=r.result; }; r.readAsDataURL(f); });
      wrapper.appendChild(secImageLabel); wrapper.appendChild(secImageInput); wrapper.appendChild(secImageUpload);
      wrapper.appendChild(navPosLabel); wrapper.appendChild(navPosSelect); wrapper.appendChild(navIndexInput);
      wrapper.appendChild(addCardBtn);
      wrapper.appendChild(cardsContainer);
      wrapper.appendChild(removeBtn);

      // populate existing cards
      (section.cards||[]).forEach(c=> createCardEditor(cardsContainer,c));

      // attach getter
      wrapper.getSection = ()=>({ key: keyInput.value.trim(), title: titleInput.value.trim(), cards: Array.from(cardsContainer.children).map(c=>c.getCard()), navPosition: navPosSelect.value==='none'? undefined: navPosSelect.value, navIndex: navIndexInput.value? parseInt(navIndexInput.value,10): undefined, imageUrl: secImageInput.value.trim() || undefined });

      container.appendChild(wrapper);
      return wrapper;
    }

    document.getElementById('addSection').addEventListener('click', ()=>{
      createSectionEditor({key:'new_section',title:'æ–°ã—ã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³',cards:[]});
    });

    function gatherForm(){
      const j = {};
      j.teamNumber = document.getElementById('teamNumber').value.trim();
      j.teamName = document.getElementById('teamName').value.trim();
      j.heroTitle = document.getElementById('heroTitle').value.trim();
      j.heroSubtitle = document.getElementById('heroSubtitle').value.trim();
      j.heroDescription = document.getElementById('heroDescription').value.trim();

      j.aboutTitle = document.getElementById('aboutTitle').value.trim();
      j.about = {cards: Array.from(document.getElementById('aboutCards').children).map(c=>c.getCard())};

      j.outreach = {title: document.getElementById('outreachTitle').value.trim(), cards: Array.from(document.getElementById('outreachCards').children).map(c=>c.getCard())};

      j.contact = { email: { title: document.getElementById('contactEmailTitle').value.trim(), text: document.getElementById('contactEmailText').value.trim() } };
      j.footer = { copy: document.getElementById('footerCopy').value.trim() };
      // extra sections
      const secs = Array.from(document.getElementById('sectionsContainer').children).map(s=> s.getSection && s.getSection()).filter(Boolean);
      if (secs.length) j.sections = secs;
      return j;
    }

    function validateJSON(j){
      const issues = [];
      // basic fields
      if (!j.teamName) issues.push('ãƒãƒ¼ãƒ åãŒç©ºã§ã™');
      if (!j.heroTitle) issues.push('ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«ãŒç©ºã§ã™');
      // check scripts
      const checkFields = [j.heroDescription, j.footer.copy];
      (j.about && j.about.cards||[]).forEach(c=>checkFields.push(c.title,c.text));
      (j.outreach && j.outreach.cards||[]).forEach(c=>checkFields.push(c.title,c.text));
      checkFields.forEach(f=>{ if (f && safeCheck(f)) issues.push('ç¦æ­¢ã‚¿ã‚°ã‚„å±æ€§ã‚’æ¤œå‡º: '+f.substring(0,60)); });
      return issues;
    }
  </script>
</body>
</html>
